{% extends 'base.html' %}
{% load static %}

{% block title %}ArchViz Platform - Home{% endblock title %}

{% block content %}
    {# == Hero Section == #}
    <section id="hero" class="relative min-h-[90vh] w-full flex items-center overflow-hidden">
        {# Interactive Background Canvas - Restored inline gradient background #}
        <canvas 
            id="interactive-hero-background" 
            class="absolute inset-0 w-full h-full z-0" 
            style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);"
        ></canvas>
        
        {# Gradient Overlay (Opacity Reduced Further) - Stays on top of canvas #}
        <div class="absolute inset-0 bg-gradient-to-r from-slate-900/80 via-slate-900/50 to-slate-900/30 z-10"></div>

        {# Content Container - Must have higher z-index than canvas #}
        <div class="relative z-20 w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-1 lg:grid-cols-5 gap-8 items-center">
            {# Left Column - Text Content - Takes 3/5 width #}
            <div class="text-left py-12 lg:py-0 lg:col-span-3">
                {# Adjusted heading structure with tracking for visual width #}
                <h1 class="text-5xl md:text-6xl lg:text-7xl font-bold text-white leading-tight mb-10">
                    <span class="tracking-wide">Explore Designs</span><br>In Interactive 3D
                </h1>
                {# Reduced max-width again for earlier wrapping & Further Increased margin bottom #}
                <div class="text-lg md:text-xl text-slate-200 mb-12 leading-relaxed max-w-xl">
                    <p>Experience architectural designs like never before through immersive 3D models, lifelike video walkthroughs, and breathtaking photorealistic AI renderings.</p>
                </div>
                {# Reverted to flex-row on small screens and up #}
                <div class="flex flex-col sm:flex-row gap-4">
                    {# TODO: Update href later #}
                    <a href="#" class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-slate-900 bg-cyan-400 hover:bg-cyan-300 transition-all duration-300 shadow-lg hover:shadow-cyan-400/20">
                        View Portfolio
                        <svg class="ml-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    </a>
                    <a href="#services" class="inline-flex items-center justify-center px-6 py-3 border border-slate-300 text-base font-medium rounded-md text-white hover:bg-white/10 transition-all duration-300">
                        Our Services
                        <svg class="ml-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    </a>
                </div>
            </div>

            {# Right Column - Re-positioned HeroShowcase structure - Takes 2/5 width #}
            <div class="hidden lg:flex lg:items-center lg:justify-center h-full relative min-h-[400px] lg:min-h-[500px] lg:col-span-2">
                {# Base container for positioning #}
                <div class="relative w-full h-full">
                
                    {# Window 1: Video Placeholder (Orange - Bottom Landscape) #}
                    <div class="absolute bottom-[-60%] left-[-25%] right-[5%] w-[195%] h-[85%] z-10 bg-slate-800/50 backdrop-blur-sm rounded-md shadow-lg overflow-hidden border-2 border-cyan-500/50">
                         <div class="absolute inset-0 flex items-center justify-center text-slate-400 text-xs">Video Placeholder</div>
                         <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-slate-900/70 to-transparent p-2 text-white">
                            <p class="text-xs font-medium">Flythrough Video</p>
                            <p class="text-[10px] text-slate-300">Interactive building tour</p>
                         </div>
                    </div>
                    
                    {# Window 2: 3D Model Placeholder (Pink - Middle Square, Top Layer) #}
                    <div class="absolute top-[-5%] left-[10%] w-[90%] h-[90%] z-20 bg-slate-800/50 backdrop-blur-sm rounded-md shadow-lg overflow-hidden border-2 border-cyan-600/50">
                         <div class="absolute inset-0 flex items-center justify-center text-slate-400 text-xs">3D Placeholder</div>
                         <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-slate-900/70 to-transparent p-2 text-white">
                             <p class="text-xs font-medium">3D Model</p>
                             <p class="text-[10px] text-slate-300">Interactive building model</p>
                         </div>
                    </div>
                    
                    {# Window 3: Image Placeholder (Green - Top-Right Portrait, Middle Layer) #}
                    <div class="absolute top-[-55%] right-[-70%] w-[85%] h-[125%] z-30 bg-slate-800/50 backdrop-blur-sm rounded-md shadow-lg overflow-hidden border-2 border-slate-600/50">
                        <div class="absolute inset-0 flex items-center justify-center text-slate-400 text-xs">Image Placeholder</div>
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-slate-900/70 to-transparent p-2 text-white">
                            <p class="text-xs font-medium">Architectural Rendering</p>
                            <p class="text-[10px] text-slate-300">High-fidelity visualization</p>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>

        {# Scroll indicator #}
        <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 z-20 animate-bounce">
            <div class="w-8 h-12 rounded-full border-2 border-white/50 flex items-start justify-center">
                <div class="w-1 h-3 bg-white rounded-full mt-2 animate-pulse"></div>
            </div>
        </div>
    </section>

    {# == Services Section == #}
    <section id="services" class="py-20 bg-slate-100 relative overflow-hidden" 
             style="background-image: url('data:image/svg+xml,%3Csvg width=\'100%25\' height=\'100%25\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cdefs%3E%3Cpattern id=\'grid\' width=\'50\' height=\'50\' patternUnits=\'userSpaceOnUse\'%3E%3Cpath d=\'M 50 0 L 0 0 0 50\' fill=\'none\' stroke=\'%23E2E8F0\' strokeWidth=\'0.5\'/%3E%3C/pattern%3E%3Cpattern id=\'circles\' width=\'100\' height=\'100\' patternUnits=\'userSpaceOnUse\'%3E%3Ccircle cx=\'50\' cy=\'50\' r=\'1\' fill=\'%23CBD5E1\' /%3E%3C/pattern%3E%3C/defs%3E%3Crect width=\'100%25\' height=\'100%25\' fill=\'url(%23grid)\' /%3E%3Crect width=\'100%25\' height=\'100%25\' fill=\'url(%23circles)\' /%3E%3C/svg%3E'); background-repeat: repeat; background-position: center; background-size: auto;">
        
        {# Content Container #}
        <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4 text-center">Our Services</h2>
            <p class="text-lg text-slate-600 mb-12 text-center max-w-3xl mx-auto">
                We offer comprehensive visualization solutions to bring your architectural designs to life
            </p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                {# Service Cards - Include the partial #}
                {% include "partials/_service_card.html" with title="3D Scans" description="Interactive 3D models that allow clients to explore spaces from every angle with precise measurements and details." link="#" %}
                {% include "partials/_service_card.html" with title="Video Renderings" description="Cinematic walkthroughs that bring architectural designs to life with movement, lighting, and atmospheric elements." link="#" %}
                {% include "partials/_service_card.html" with title="Still Imagery" description="High-resolution architectural visualizations with photorealistic quality, perfect lighting, and detailed textures." link="#" %}
            </div>
        </div>
    </section>

    {# == Featured Projects Section == #}
    <section id="featured-projects" class="bg-slate-100 py-16 px-4 sm:px-6 lg:px-8 h-[500px]"> {# Increased height slightly #}
        <div class="max-w-7xl mx-auto">
            <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-10 text-center">Featured Projects</h2>
            {# Horizontal Scroll Container #}
            <div class="flex overflow-x-auto space-x-8 pb-6 scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200">
                {# Placeholder Project Images (Repeat as needed) #}
                {% for i in "12345678" %}
                <div class="flex-shrink-0 w-80 h-64 bg-slate-300 rounded-lg shadow-md flex items-center justify-center text-slate-500">
                    Project {{ i }} Placeholder
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    {# == Client Portal Section == #}
    <section id="client-portal" class="py-20 bg-slate-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4 text-center">Client Portal</h2>
            <p class="text-lg text-slate-600 mb-6 text-center max-w-3xl mx-auto">
                Access your personalized dashboard with project-specific visualizations
            </p>
            <div class="flex justify-center mb-12">
                <a href="#" {# TODO: Link to login page later #}
                   class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-slate-800 hover:bg-slate-700 transition-all duration-300 shadow-md">
                    {# Placeholder icon - replace with actual lock icon later #}
                    <span class="mr-2">[L]</span> 
                    Secure Login
                </a>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                {# Client Portal Feature Cards #}
                {% include "partials/_client_portal_card.html" with title="Personalized Dashboard" description="Access a custom dashboard tailored to your projects with all your architectural visualizations in one place." icon_name="dashboard" %}
                {% include "partials/_client_portal_card.html" with title="Project-Specific Content" description="View 3D scans, video renderings, and still imagery created specifically for your architectural projects." icon_name="building" %}
                {% include "partials/_client_portal_card.html" with title="Secure Access" description="Rest easy knowing your project data is protected with enterprise-grade security and encryption." icon_name="shield" %}
                {% include "partials/_client_portal_card.html" with title="Team Collaboration" description="Share access with team members and stakeholders to streamline feedback and decision-making." icon_name="users" %}
            </div>

            {# Lower Details Block - Placeholder Structure #}
            <div class="mt-16 bg-white rounded-lg shadow-md overflow-hidden">
                 <div class="grid grid-cols-1 lg:grid-cols-2">
                     <div class="p-8 flex flex-col justify-center">
                         <h3 class="text-2xl font-bold text-slate-900 mb-4">Experience Your Projects Like Never Before</h3>
                         <p class="text-slate-600 mb-6">
                             Our client portal provides a seamless way to access, review, and share your architectural visualizations...
                         </p>
                         {# Placeholder for list & button #}
                         <div class="bg-slate-100 p-4 rounded text-slate-500 text-sm">Placeholder for list & button</div>
                     </div>
                     <div class="bg-slate-100 p-4 flex items-center justify-center min-h-[200px]">
                         <div class="text-slate-500">Placeholder for Dashboard Preview Image</div>
                     </div>
                 </div>
             </div>
        </div>
    </section>

    {# == News Section == #}
    <section id="news" class="py-20 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4 text-center">Latest News</h2>
            <p class="text-lg text-slate-600 mb-12 text-center max-w-3xl mx-auto">
                Stay updated with our latest projects, technologies, and industry insights
            </p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                {# News Articles - Placeholders using the partial's defaults #}
                {% include "partials/_news_card.html" %}
                {% include "partials/_news_card.html" %}
                {% include "partials/_news_card.html" %}
            </div>
            <div class="text-center mt-12">
                <a href="#" {# TODO: Link to news list page later #}
                   class="inline-flex items-center justify-center px-6 py-3 border border-slate-300 text-base font-medium rounded-md text-slate-700 hover:bg-slate-100 transition-all duration-300">
                    View All News
                     {# Placeholder icon - replace with actual arrow icon later #}
                    <span class="ml-2">&rarr;</span> 
                </a>
            </div>
        </div>
    </section>

    {# == CTA Banner Section == #}
    <section id="cta-banner" class="py-20 bg-gradient-to-r from-slate-900 to-slate-800 text-white">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-3xl md:text-4xl font-bold mb-6">Ready to Transform Your Architectural Designs?</h2>
            <p class="text-lg md:text-xl mb-10 max-w-3xl mx-auto">
                Let's collaborate to create stunning visualizations that bring your vision to life
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="#" {# TODO: Link to contact page later #}
                   class="inline-flex items-center justify-center px-8 py-4 border border-transparent text-base font-medium rounded-md text-slate-900 bg-cyan-400 hover:bg-cyan-300 transition-all duration-300 shadow-lg hover:shadow-cyan-400/20">
                    Get in Touch
                    {# Placeholder icon - replace with actual arrow icon later #}
                    <span class="ml-2">&rarr;</span> 
                </a>
                <a href="#" {# TODO: Link to portfolio page later #}
                   class="inline-flex items-center justify-center px-8 py-4 border border-slate-300 text-base font-medium rounded-md text-white hover:bg-white/10 transition-all duration-300">
                    Explore Portfolio
                </a>
            </div>
        </div>
    </section>

{% endblock content %} 

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const canvas = document.getElementById('interactive-hero-background');
    if (!canvas) {
        console.error("Canvas element not found!");
        return;
    }
    const ctx = canvas.getContext('2d');
    if (!ctx) {
        console.error("Could not get 2D context");
        return;
    }

    let mouse = { x: undefined, y: undefined };
    let animationFrameId;
    let gridPoints = [];

    // -- Configuration (from interactive-background.txt) --
    const config = {
        spacing: 65, // Increased spacing for performance
        pointSize: 1.4, // Reduced point size
        maxLineDistance: 95, // Increased again to restore connection density
        baseColorHex: "#22D3EE", // Cyan-500 equivalent base color for points/lines
        hoverColorHex: "#FFFFFF", // Color to shift towards on hover
        baseLineOpacity: 0.18, // Reduced base line opacity
        hoverLineOpacityBoost: 0.35, // Reduced opacity boost on hover
        mouseRadius: 250, // Increased radius of mouse influence
        waveAmplitude: 4, // Amplitude of the subtle background wave
        waveFrequency1: 0.0012,
        waveFrequency2: 0.007,
        waveSpeed: 0.01,
        randomOffset: 15, // Max random offset for initial point positions
        mouseUpwardForce: 0.8, // How strongly points move up near mouse (adjust for subtlety)
        mouseHorizontalForce: 0.1, // Slight push away horizontally
        returnToBaseSpeed: 0.07, // Slightly faster return
        colorTransitionSpeed: 0.1, // How quickly color returns to base
    };
    // -------------------

    // Helper function: Clamp
    const clamp = (val, min, max) => Math.min(Math.max(val, min), max);

    // Helper function: Lerp Color
    function lerpColor(hexColorA, hexColorB, amount) {
        amount = clamp(amount, 0, 1);
        const colorA = parseInt(hexColorA.slice(1), 16);
        const colorB = parseInt(hexColorB.slice(1), 16);
        const rA = (colorA >> 16) & 255, gA = (colorA >> 8) & 255, bA = colorA & 255;
        const rB = (colorB >> 16) & 255, gB = (colorB >> 8) & 255, bB = colorB & 255;
        const r = Math.round(rA + (rB - rA) * amount);
        const g = Math.round(gA + (gB - gA) * amount);
        const b = Math.round(bA + (bB - bA) * amount);
        return `#${((1 << 24) | (r << 16) | (g << 8) | b).toString(16).slice(1).padStart(6, '0')}`;
    }

    // Helper function: Hex to RGBA
    function hexToRgba(hex, alpha) {
        alpha = clamp(alpha, 0, 1);
        const r = parseInt(hex.slice(1, 3), 16);
        const g = parseInt(hex.slice(3, 5), 16);
        const b = parseInt(hex.slice(5, 7), 16);
        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }

    // Grid Point Class
    class GridPoint {
        constructor(x, y) {
            const offsetX = (Math.random() - 0.5) * 2 * config.randomOffset;
            const offsetY = (Math.random() - 0.5) * 2 * config.randomOffset;
            this.baseX = x + offsetX;
            this.baseY = y + offsetY;
            this.x = this.baseX;
            this.y = this.baseY;
            this.targetX = this.baseX;
            this.targetY = this.baseY;
            this.currentSize = config.pointSize;
            this.targetSize = config.pointSize;
            this.currentColorHex = config.baseColorHex;
            this.targetColorHex = config.baseColorHex;
            this.angle1 = Math.random() * Math.PI * 2;
            this.angle2 = Math.random() * Math.PI * 2;
        }

        update(time, mousePos) {
            this.x += (this.targetX - this.x) * config.returnToBaseSpeed;
            this.y += (this.targetY - this.y) * config.returnToBaseSpeed;
            this.currentColorHex = lerpColor(this.currentColorHex, this.targetColorHex, config.colorTransitionSpeed);
            this.currentSize += (this.targetSize - this.currentSize) * config.colorTransitionSpeed;

            this.angle1 += config.waveSpeed;
            this.angle2 += config.waveSpeed * 0.7;
            const waveY = (Math.sin(this.angle1 + this.baseX * config.waveFrequency1) + Math.sin(this.angle2 + this.baseY * config.waveFrequency2)) * config.waveAmplitude * 0.5;

            let targetWaveY = this.baseY + waveY;
            let targetWaveX = this.baseX;
            let targetColor = config.baseColorHex;
            let targetSize = config.pointSize;

            if (mousePos.x !== undefined && mousePos.y !== undefined) {
                const dx = mousePos.x - this.x;
                const dy = mousePos.y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < config.mouseRadius) {
                    const force = Math.pow(1 - distance / config.mouseRadius, 2);
                    targetWaveY -= force * config.mouseUpwardForce * 50;
                    const directionX = dx / (distance || 1); // Avoid division by zero
                    targetWaveX -= directionX * force * config.mouseHorizontalForce * 50;
                    targetColor = lerpColor(config.baseColorHex, config.hoverColorHex, force * 0.5);
                    targetSize = config.pointSize + force * 1.0;
                }
            }
            this.targetX = targetWaveX;
            this.targetY = targetWaveY;
            this.targetColorHex = targetColor;
            this.targetSize = targetSize;
        }

        draw(ctx) {
            ctx.fillStyle = hexToRgba(this.currentColorHex, 0.4);
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.currentSize, 0, Math.PI * 2);
            ctx.closePath();
            ctx.fill();
        }
    }

    function initGrid() {
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        ctx.imageSmoothingEnabled = true;

        gridPoints = [];
        const spacing = config.spacing;
        const cols = Math.floor(canvas.width / dpr / spacing) + 4;
        const rows = Math.floor(canvas.height / dpr / spacing) + 4;
        const xOffset = -spacing * 1.5;
        const yOffset = -spacing * 1.5;

        for (let y = 0; y < rows; y++) {
            for (let x = 0; x < cols; x++) {
                gridPoints.push(new GridPoint(x * spacing + xOffset, y * spacing + yOffset));
            }
        }
    }

    function connectPoints() {
        const points = gridPoints;
        const maxDistanceSq = config.maxLineDistance * config.maxLineDistance;
        const whiteHexNum = parseInt(config.hoverColorHex.slice(1), 16);
        const baseHexNum = parseInt(config.baseColorHex.slice(1), 16);
        const colorDiffRange = Math.abs(whiteHexNum - baseHexNum + 1); // Avoid div by zero

        for (let i = 0; i < points.length; i++) {
            for (let j = i + 1; j < points.length; j++) {
                const p1 = points[i];
                const p2 = points[j];
                const dx = p1.x - p2.x;
                const dy = p1.y - p2.y;
                const distanceSq = dx * dx + dy * dy;

                if (distanceSq < maxDistanceSq) {
                    const distance = Math.sqrt(distanceSq);
                    const opacityFactor = 1 - distance / config.maxLineDistance; // Renamed from opacity

                    const c1HexNum = parseInt(p1.currentColorHex.slice(1), 16);
                    const c2HexNum = parseInt(p2.currentColorHex.slice(1), 16);

                    const progress1 = Math.abs(c1HexNum - baseHexNum) / colorDiffRange;
                    const progress2 = Math.abs(c2HexNum - baseHexNum) / colorDiffRange;
                    const avgProgress = (progress1 + progress2) / 2;

                    const lineColorHex = lerpColor(config.baseColorHex, config.hoverColorHex, avgProgress * 0.8);
                    const finalOpacity = config.baseLineOpacity + opacityFactor * config.hoverLineOpacityBoost * avgProgress;

                    ctx.strokeStyle = hexToRgba(lineColorHex, finalOpacity);
                    ctx.lineWidth = 0.5;
                    ctx.beginPath();
                    ctx.moveTo(p1.x, p1.y);
                    ctx.lineTo(p2.x, p2.y);
                    ctx.stroke();
                }
            }
        }
    }

    function animate() {
        ctx.clearRect(0, 0, canvas.width / (window.devicePixelRatio || 1), canvas.height / (window.devicePixelRatio || 1)); // Use logical canvas size for clearRect
        const time = performance.now() * 0.001;

        for (let i = 0; i < gridPoints.length; i++) {
            gridPoints[i].update(time, mouse);
            gridPoints[i].draw(ctx);
        }
        connectPoints();
        animationFrameId = requestAnimationFrame(animate);
    }

    // Event Listeners
    const handleResize = () => initGrid();
    const handleMouseMove = (event) => {
        const rect = canvas.getBoundingClientRect();
        mouse.x = event.clientX - rect.left;
        mouse.y = event.clientY - rect.top;
    };
    const handleMouseLeave = () => {
        mouse.x = undefined;
        mouse.y = undefined;
    };

    window.addEventListener('resize', handleResize);
    window.addEventListener('mousemove', handleMouseMove); // Now attached to window
    canvas.addEventListener('mouseleave', handleMouseLeave);

    // Initial setup and start animation
    initGrid();
    animate();

    // Basic Cleanup (Consider more robust cleanup if needed)
    // This might run too early if navigating away using client-side routing
    // A more complex setup might be needed for SPA-like behavior
    window.addEventListener('beforeunload', () => {
         window.removeEventListener('resize', handleResize);
         window.removeEventListener('mousemove', handleMouseMove); // Remove listener from window
         canvas.removeEventListener('mouseleave', handleMouseLeave);
         if (animationFrameId) {
             cancelAnimationFrame(animationFrameId);
         }
    });
});
</script>
{% endblock scripts %} 